<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HS | Working with Rails Nested Forms</title>

	<!--  Favicons  -->
	<link rel="shortcut icon" href="/assets/images/favicon/favicon.ico">
	<link rel="apple-touch-icon-precomposed" href="/assets/images/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/images/favicon/apple-touch-icon-57x57.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/images/favicon/apple-touch-icon-72x72.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/images/favicon/apple-touch-icon-114x114.png" />

	<!--  Google Font  -->
	<link href='http://fonts.googleapis.com/css?family=Roboto:400,100,700' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Droid+Sans' rel='stylesheet' type='text/css'>

	<!--  Stylesheet  -->
	<link href="/assets/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="/assets/css/style.css" rel="stylesheet">
    <link href="/assets/css/prism.css" rel="stylesheet">
	<link href="/assets/css/responsive.css" rel="stylesheet">

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
	<!-- Preloader -->
	<div id="preloader">
		<div id="status">&nbsp;</div>
	</div>

    <!-- ****** blog header moved to partial ****** -->
    <header id="header" class="header navbar-fixed-top">
        <div class="container">
            <!-- Static navbar -->
            <div class="navbar" role="navigation">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/">HÃ©ber Sandoval</a>
                </div>
                <div class="navbar-collapse collapse">
                    <!-- Right nav -->
                    <ul class="nav navbar-nav right">
                        <li><a href="/">Home</a></li>
                        
                        <li><a href="/blog">Blog</a></li>
                        <li><a href="/about">About Me</a></li>
                        <li><a href="/contact">Contact Me</a></li>
                    </ul>
                </div>
                <!--/.nav-collapse -->
            </div>
        </div> <!-- End .container -->
    </header>
    <!--
    =====================
            End Header
    =====================
    -->

    <!-- ****** blog slider moved to partial ****** -->
	
	<!-- ****** blog-post section deleted ****** -->
	
	
<section id="page-title" class="page-title">
    <div class="bg-title">
        <div class="container">
            <div class="title">
                <h1>Single Post</h1>
            </div><!-- End .title -->
            <div class="breadcrumb">
                <ul>
                    <li><a href="/blog">Blog</a></li>
                    <li>Working with Rails Nested Forms</li>
                </ul>
            </div>
        </div> <!-- End .conatainer -->
    </div>
</section>
<!--
=====================
    End Page Title
=====================
-->
<section id="content">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <div class="primary">
                    <div class="blog-post">
                        <div class="thum-item">
                            <img src="/assets/images/kingfisher.jpg" alt="Post Thumnail Image">
                        </div> <!-- End .thum-item -->
                        <div class="post">
                            <div class="blog-title">
                                <h2>Working with Rails Nested Forms</h2>
                            </div>
                            <div class="meta">
                                <ul>
                                    <li class="category"><a href="archive.html">Lifestyle</a></li>
                                    <li class="author">By Admin</li>
                                    <li class="date">October 19, 2016</li>
                                    <li class="comment">4 Comments</li>
                                </ul>
                            </div> <!-- End .meta -->
                            <div class="content">

                                <!-- Excerpt Start -->
<p>Getting nested forms to work correctly. This is what I'll discuss briefly. I'll attempt to nest the <code>Ingredient</code> model under the <code>Recipe</code> model in a form so that a user can input a recipe and its associated ingredients.</p>
<!-- Excerpt End -->
<h2>Working with Rails Nested Forms</h2>
<p>To get all the pieces connected, I needed to associate all the models for this exercise, see my blog on &quot;model associations&quot; (create link). Here is the <code>RecipesController</code>, with a <code>new</code>, <code>create</code> action.</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">RecipesController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span><br>  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">new</span></span><br>    <span class="token variable">@recipe</span> <span class="token operator">=</span> <span class="token constant">Recipe</span><span class="token punctuation">.</span><span class="token keyword">new</span><br>  <span class="token keyword">end</span><br><br>  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">create</span></span><br>    <span class="token comment"># raise params.inspect</span><br>    <span class="token variable">@recipe</span> <span class="token operator">=</span> <span class="token constant">Recipe</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>recipe_params<span class="token punctuation">)</span><br>    <span class="token keyword">if</span> <span class="token variable">@recipe</span><span class="token punctuation">.</span>save<br>      redirect_to recipe_path<span class="token punctuation">(</span><span class="token variable">@recipe</span><span class="token punctuation">)</span><br>    <span class="token keyword">else</span><br>      render <span class="token symbol">:new</span><br>    <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br><br>  <span class="token keyword">private</span><br><br>  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">recipe_params</span></span><br>    params<span class="token punctuation">.</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token symbol">:recipe</span><span class="token punctuation">)</span><span class="token punctuation">.</span>permit<span class="token punctuation">(</span><span class="token symbol">:name</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span></code></pre>
<p>Below, we have a <code>form_for</code> form builder to create a form for a recipe. The part that we'll be concentrating is how to associate any amount of ingredients to this recipe. For now, this is being hard-coded in html.</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token constant">New</span> <span class="token constant">Recipe</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br><br><span class="token operator">&lt;</span><span class="token string">%= form_for(@recipe) do |f| %><br>  &lt;%=</span> f<span class="token punctuation">.</span>label <span class="token symbol">:name</span> <span class="token string">%><br>  &lt;%= f.text_field :name %></span><br><br>  <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token constant">Add</span> <span class="token constant">Ingredients</span><span class="token punctuation">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>  <span class="token operator">&lt;</span>ul<span class="token operator">></span><br>    <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"ingredients[][name]"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><br>    <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"ingredients[][name]"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><br>    <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"ingredients[][name]"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span><br><br>  <span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">=</span> f<span class="token punctuation">.</span>submit <span class="token string">%><br>&lt;% end %></span></code></pre>
<p>Right now, we can grab the value of <code>params</code> in the form of an array of hashes, which we hard-coded to accept. When the form is submitted, this is what the <code>params</code> looks like.</p>
<pre><code>{&quot;utf8&quot;=&gt;&quot;â&quot;,
 &quot;authenticity_token&quot;=&gt;&quot;vAsZKoce0jNHjOBWxhHX6QcgesAiEmueBDUgmKmK4gU2nPvnQDTTOdt7bd0oDIO8Libc1ax6QQQ83MhQkvxDVw==&quot;,
 &quot;recipe&quot;=&gt;{&quot;name&quot;=&gt;&quot;Pizza&quot;},
 &quot;ingredients&quot;=&gt;[{&quot;name&quot;=&gt;&quot;cheese&quot;},
 {&quot;name&quot;=&gt;&quot;tomatoes&quot;},
 {&quot;name&quot;=&gt;&quot;lettuce&quot;}],
 &quot;commit&quot;=&gt;&quot;Create Recipe&quot;}
</code></pre>
<p>So, when the user types &quot;Pizza&quot; in the text field for the recipe's name, it's saved in the <code>params</code> as <code>&quot;recipe&quot;=&gt;{&quot;name&quot;=&gt;&quot;Pizza&quot;}</code>, as shown above. At the same time, when the user enters many values in the text field for the ingredients, it's saved as <code>&quot;ingredients&quot;=&gt;[{&quot;name&quot;=&gt;&quot;cheese&quot;}, {&quot;name&quot;=&gt;&quot;tomatoes&quot;}, {&quot;name&quot;=&gt;&quot;lettuce&quot;}]</code> in the <code>params</code>, which is an array of hashes.</p>
<p>Where do we go from here? We can use the array of hashes that we get back from <code>params</code> and use them to build a recipe with ingredients, thanks to the model association. Since we know what <code>params</code> looks like and we only want the value of the recipe hash we can iterate over this hash.</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">RecipesController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span><br>  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">create</span></span><br>    <span class="token variable">@recipe</span> <span class="token operator">=</span> <span class="token constant">Recipe</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>recipe_params<span class="token punctuation">)</span><br>    params<span class="token punctuation">[</span><span class="token symbol">:recipes</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>ingredient<span class="token operator">|</span><br>      <span class="token variable">@recipe</span><span class="token punctuation">.</span>ingredients<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token symbol">:name</span> <span class="token operator">=</span><span class="token operator">></span> ingredient<span class="token punctuation">[</span><span class="token symbol">:name</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token keyword">end</span><br>    <span class="token keyword">if</span> <span class="token variable">@recipe</span><span class="token punctuation">.</span>save<br>      <span class="token comment"># raise params.inspect</span><br>      redirect_to recipe_path<span class="token punctuation">(</span><span class="token variable">@recipe</span><span class="token punctuation">)</span><br>    <span class="token keyword">else</span><br>      render <span class="token symbol">:new</span><br>    <span class="token keyword">end</span><br>  <span class="token keyword">end</span></code></pre>
<p>The <code>@recipe.ingredients.build(:name =&gt; ingredient[:name])</code> is associating each of the ingredients with the corresponding recipe. When the parent object is save the child object is saved automatically too. But we can refactor this a bit more.</p>
<p>Since we are adding an attribute to the ingredient and associating it with a recipe, we can build a custom method in the recipe's model called <code>ingredients_attributes=(ingredients)</code>.</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">Recipe</span> <span class="token operator">&lt;</span> <span class="token constant">ActiveRecord</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span><br>  has_many <span class="token symbol">:pantries</span><br>  has_many <span class="token symbol">:ingredients</span><span class="token punctuation">,</span> through<span class="token punctuation">:</span> <span class="token symbol">:pantries</span><br><br>  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">ingredients_attributes</span></span><span class="token operator">=</span><span class="token punctuation">(</span>ingredients<span class="token punctuation">)</span><br>    ingredients<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>ingredient_hash<span class="token operator">|</span><br>      <span class="token keyword">self</span><span class="token punctuation">.</span>ingredients<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token symbol">:name</span> <span class="token operator">=</span><span class="token operator">></span> ingredient_hash<span class="token punctuation">[</span><span class="token symbol">:name</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span></code></pre>
<p>This custom method takes an argument of hash ingredients and iterates over each hash collecting the name attribute for each ingredient and builds a recipe with each ingredient.</p>
<p>This is how the RecipesController looks like now:</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">RecipesController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span><br><br>  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">create</span></span><br>    <span class="token variable">@recipe</span> <span class="token operator">=</span> <span class="token constant">Recipe</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>recipe_params<span class="token punctuation">)</span><br>    <span class="token variable">@recipe</span><span class="token punctuation">.</span>ingredients_attributes<span class="token operator">=</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:ingredients</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token keyword">if</span> <span class="token variable">@recipe</span><span class="token punctuation">.</span>save<br>      redirect_to recipe_path<span class="token punctuation">(</span><span class="token variable">@recipe</span><span class="token punctuation">)</span><br>    <span class="token keyword">else</span><br>      render <span class="token symbol">:new</span><br>    <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span></code></pre>
<p>Once the submit button is clicked, the rails server output confirms that this action worked.</p>
<pre><code>Started POST &quot;/recipes&quot; for ::1 at 2016-10-13 17:26:16 -0400
Processing by RecipesController#create as HTML

  Parameters: {&quot;utf8&quot;=&gt;&quot;â&quot;, &quot;authenticity_token&quot;=&gt;&quot;vAsZKoce0jNHjOBWxhHX6QcgesAiEmueBDUgmKmK4gU2nPvnQDTTOdt7bd0oDIO8Libc1ax6QQQ83MhQkvxDVw==&quot;, &quot;recipe&quot;=&gt;{&quot;name&quot;=&gt;&quot;Pizza&quot;}, &quot;ingredients&quot;=&gt;[{&quot;name&quot;=&gt;&quot;cheese&quot;}, {&quot;name&quot;=&gt;&quot;tomatoes&quot;}, {&quot;name&quot;=&gt;&quot;lettuce&quot;}], &quot;commit&quot;=&gt;&quot;Create Recipe&quot;}

   (0.0ms)  begin transaction
  SQL (4.1ms)  INSERT INTO &quot;recipes&quot; (&quot;name&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES (?, ?, ?)  [[&quot;name&quot;, &quot;Pizza&quot;], [&quot;created_at&quot;, &quot;2016-10-13 21:26:16.437033&quot;], [&quot;updated_at&quot;, &quot;2016-10-13 21:26:16.437033&quot;]]

  SQL (0.0ms)  INSERT INTO &quot;ingredients&quot; (&quot;name&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES (?, ?, ?)  [[&quot;name&quot;, &quot;cheese&quot;], [&quot;created_at&quot;, &quot;2016-10-13 21:26:16.441095&quot;], [&quot;updated_at&quot;, &quot;2016-10-13 21:26:16.441095&quot;]]

  SQL (0.0ms)  INSERT INTO &quot;pantries&quot; (&quot;recipe_id&quot;, &quot;ingredient_id&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES (?, ?, ?, ?)  [[&quot;recipe_id&quot;, 7], [&quot;ingredient_id&quot;, 7], [&quot;created_at&quot;, &quot;2016-10-13 21:26:16.449028&quot;], [&quot;updated_at&quot;, &quot;2016-10-13 21:26:16.449028&quot;]]

  SQL (0.0ms)  INSERT INTO &quot;ingredients&quot; (&quot;name&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES (?, ?, ?)  [[&quot;name&quot;, &quot;tomatoes&quot;], [&quot;created_at&quot;, &quot;2016-10-13 21:26:16.452992&quot;], [&quot;updated_at&quot;, &quot;2016-10-13 21:26:16.452992&quot;]]

  SQL (0.0ms)  INSERT INTO &quot;pantries&quot; (&quot;recipe_id&quot;, &quot;ingredient_id&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES (?, ?, ?, ?)  [[&quot;recipe_id&quot;, 7], [&quot;ingredient_id&quot;, 8], [&quot;created_at&quot;, &quot;2016-10-13 21:26:16.456993&quot;], [&quot;updated_at&quot;, &quot;2016-10-13 21:26:16.456993&quot;]]

  SQL (0.0ms)  INSERT INTO &quot;ingredients&quot; (&quot;name&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES (?, ?, ?)  [[&quot;name&quot;, &quot;lettuce&quot;], [&quot;created_at&quot;, &quot;2016-10-13 21:26:16.461008&quot;], [&quot;updated_at&quot;, &quot;2016-10-13 21:26:16.461008&quot;]]

  SQL (0.0ms)  INSERT INTO &quot;pantries&quot; (&quot;recipe_id&quot;, &quot;ingredient_id&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES (?, ?, ?, ?)  [[&quot;recipe_id&quot;, 7], [&quot;ingredient_id&quot;, 9], [&quot;created_at&quot;, &quot;2016-10-13 21:26:16.465004&quot;], [&quot;updated_at&quot;, &quot;2016-10-13 21:26:16.465004&quot;]]
   (28.7ms)  commit transaction
Redirected to http://localhost:3000/recipes/7
Completed 302 Found in 89ms (ActiveRecord: 32.8ms)
</code></pre>
<p>We can test this in the rails console to double check.</p>
<pre><code>&gt; recipe=Recipe.find(5)
  Recipe Load (0.0ms)  SELECT  &quot;recipes&quot;.* FROM &quot;recipes&quot; WHERE &quot;recipes&quot;.&quot;id&quot; = ? LIMIT 1  [[&quot;id&quot;, 5]]
=&gt; #&lt;Recipe id: 5, name: &quot;Pizza&quot;, created_at: &quot;2016-10-13 21:22:57&quot;, updated_at: &quot;2016-10-13 21:22:57&quot;&gt;

&gt; recipe.ingredients
  Ingredient Load (0.0ms)  SELECT &quot;ingredients&quot;.* FROM &quot;ingredients&quot; INNER JOIN &quot;pantries&quot; ON &quot;ingredients&quot;.&quot;id&quot; = &quot;pantries&quot;.&quot;ingredient_id&quot; WHERE &quot;pantries&quot;.&quot;recipe_id&quot; = ?  [[&quot;recipe_id&quot;, 5]]
=&gt; #&lt;ActiveRecord::Associations::CollectionProxy [#&lt;Ingredient id: 1, name: &quot;cheese&quot;, created_at: &quot;2016-10-13 21:22:57&quot;, updated_at: &quot;2016-10-13 21:22:57&quot;&gt;, #&lt;Ingredient id: 2, name: &quot;tomatoes&quot;, created_at: &quot;2016-10-13 21:22:57&quot;, updated_at: &quot;2016-10-13 21:22:57&quot;&gt;, #&lt;Ingredient id: 3, name: &quot;lettuce&quot;, created_at: &quot;2016-10-13 21:22:57&quot;, updated_at: &quot;2016-10-13 21:22:57&quot;&gt;]&gt;
</code></pre>
<p>Great!</p>
<p>To prevent from saving empty text fields, we can add an <code>if</code> statement to the recipe's model <code>ingredients_attributes=</code> method:</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token keyword">self</span><span class="token punctuation">.</span>ingredients<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token symbol">:name</span> <span class="token operator">=</span><span class="token operator">></span> ingredient_hash<span class="token punctuation">[</span><span class="token symbol">:name</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">if</span> ingredient_hash<span class="token punctuation">[</span><span class="token symbol">:name</span><span class="token punctuation">]</span><span class="token punctuation">.</span>present<span class="token operator">?</span></code></pre>
<p>Now lets focus on generating the form using rails for the ingredients. So far, this is what we have:</p>
<pre><code>&lt;p&gt;Add Ingredients:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;input type=&quot;text&quot; name=&quot;ingredients[][name]&quot;&gt;&lt;/li&gt;
  &lt;li&gt;&lt;input type=&quot;text&quot; name=&quot;ingredients[][name]&quot;&gt;&lt;/li&gt;
  &lt;li&gt;&lt;input type=&quot;text&quot; name=&quot;ingredients[][name]&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
</code></pre>
<p>To go one level up of abstraction, we can use a <code>text_field_tag</code>.</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token constant">Add</span> <span class="token constant">Ingredients</span><span class="token punctuation">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br><span class="token operator">&lt;</span>ul<span class="token operator">></span><br>  <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span><span class="token string">%= text_field_tag 'ingredients[][name]' %>&lt;/li><br>  &lt;li>&lt;%=</span> text_field_tag <span class="token string">'ingredients[][name]'</span> <span class="token string">%>&lt;/li></span><br>  <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">=</span> text_field_tag <span class="token string">'ingredients[][name]'</span> <span class="token string">%>&lt;/li></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span></code></pre>
<p>This will work just the same as the good old html code. But since we're using <code>ingredients_attributes</code> in our controller, we can use it to build a form. In this case, a recipe has a hash of ingredients which has an attribute of name and the following will work.</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token constant">Add</span> <span class="token constant">Ingredients</span><span class="token punctuation">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br><span class="token operator">&lt;</span>ul<span class="token operator">></span><br>  <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span><span class="token string">%= text_field_tag 'recipe[ingredients_attributes][][name]' %>&lt;/li><br>  &lt;li>&lt;%=</span> text_field_tag <span class="token string">'recipe[ingredients_attributes][][name]'</span> <span class="token string">%>&lt;/li></span><br>  <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">=</span> text_field_tag <span class="token string">'recipe[ingredients_attributes][][name]'</span> <span class="token string">%>&lt;/li></span><br><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span></code></pre>
<p>We can mass assign our nested attributes in the controller like this and sanitize these attributes with strong params.</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">RecipesController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span><br>  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">create</span></span><br>    <span class="token variable">@recipe</span> <span class="token operator">=</span> <span class="token constant">Recipe</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>recipe_params<span class="token punctuation">)</span><br>    <span class="token variable">@recipe</span><span class="token punctuation">.</span>ingredients_attributes<span class="token operator">=</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token symbol">:recipe</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token symbol">:ingredients_attributes</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token keyword">if</span> <span class="token variable">@recipe</span><span class="token punctuation">.</span>save<br>      redirect_to recipe_path<span class="token punctuation">(</span><span class="token variable">@recipe</span><span class="token punctuation">)</span><br>    <span class="token keyword">else</span><br>      render <span class="token symbol">:new</span><br>    <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br><br>  <span class="token keyword">private</span><br><br>  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">recipe_params</span></span><br>    params<span class="token punctuation">.</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token symbol">:recipe</span><span class="token punctuation">)</span><span class="token punctuation">.</span>permit<span class="token punctuation">(</span><span class="token symbol">:name</span><span class="token punctuation">,</span> <span class="token symbol">:ingredients_attributes</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token symbol">:name</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span></code></pre>
<p>Moving one level of abstraction, we can use the <code>form_for</code> build to help us create what we're essentially doing, looping through each ingredient in the each text field.</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token constant">Add</span> <span class="token constant">Ingredients</span><span class="token punctuation">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br><span class="token operator">&lt;</span>ul<span class="token operator">></span><br>  <span class="token operator">&lt;</span><span class="token string">%= f.fields_for :ingredients do |ingredient_field| %><br>    &lt;li>&lt;%=</span> ingredient_field<span class="token punctuation">.</span>text_field <span class="token symbol">:name</span> <span class="token string">%>&lt;/li></span><br>  <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">end</span> <span class="token string">%><br>&lt;/ul></span></code></pre>
<p>Now we have a new form builder that can build a text field for each ingredient to the recipe. The associated model must respond to a writer method, which we created. If we navigate to the form, it will work but the forms to input the ingredients are missing. To add them, we need to add some code in the RecipesController new action.</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token keyword">class</span> <span class="token class-name">RecipesController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span><br>  <span class="token keyword">def</span> <span class="token method-definition"><span class="token function">new</span></span><br>    <span class="token variable">@recipe</span> <span class="token operator">=</span> <span class="token constant">Recipe</span><span class="token punctuation">.</span><span class="token keyword">new</span><br>    <span class="token number">3.</span>times <span class="token keyword">do</span><br>      <span class="token variable">@recipe</span><span class="token punctuation">.</span>ingredients<span class="token punctuation">.</span>build<br>    <span class="token keyword">end</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span></code></pre>
<p>This is how the html looks like.</p>
<pre><code>&lt;li&gt;
  &lt;input name=&quot;recipe[ingredients_attributes][0][name]&quot; id=&quot;recipe_ingredients_attributes_0_name&quot; type=&quot;text&quot;&gt;
&lt;/li&gt;
&lt;li&gt;
  &lt;input name=&quot;recipe[ingredients_attributes][1][name]&quot; id=&quot;recipe_ingredients_attributes_1_name&quot; type=&quot;text&quot;&gt;
&lt;/li&gt;
&lt;li&gt;
  &lt;input name=&quot;recipe[ingredients_attributes][2][name]&quot; id=&quot;recipe_ingredients_attributes_2_name&quot; type=&quot;text&quot;&gt;
&lt;/li&gt;
</code></pre>
<p>If you submit the form, you will see this:</p>
<pre><code>TypeError in RecipesController#create
no implicit conversion of Symbol into Integer
Rails.root: C:/Users/hmisa/Documents/proj/ror/test/test_nested_attributes
</code></pre>
<p>This means that we need to allow the index of each ingredients as shown above.</p>
<pre class="language-ruby"><code class="language-ruby"><span class="token keyword">def</span> <span class="token method-definition"><span class="token function">ingredients_attributes</span></span><span class="token operator">=</span><span class="token punctuation">(</span>ingredients<span class="token punctuation">)</span><br>  ingredients<span class="token punctuation">.</span><span class="token keyword">each</span> <span class="token keyword">do</span> <span class="token operator">|</span>i<span class="token punctuation">,</span> ingredient_hash<span class="token operator">|</span><br>    <span class="token keyword">self</span><span class="token punctuation">.</span>ingredients<span class="token punctuation">.</span>build<span class="token punctuation">(</span><span class="token symbol">:name</span> <span class="token operator">=</span><span class="token operator">></span> ingredient_hash<span class="token punctuation">[</span><span class="token symbol">:name</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span></code></pre>
<p>And there is our input forms. Now params looks like this.</p>
<pre><code>=&gt; {&quot;utf8&quot;=&gt;&quot;â&quot;, &quot;authenticity_token&quot;=&gt;&quot;/wnR...&quot;, &quot;recipe&quot;=&gt;{&quot;name&quot;=&gt;&quot;&quot;, &quot;ingredients_attributes&quot;=&gt;{&quot;0&quot;=&gt;{&quot;name&quot;=&gt;&quot;cheese&quot;}, &quot;1&quot;=&gt;{&quot;name&quot;=&gt;&quot;tomatoes&quot;}, &quot;2&quot;=&gt;{&quot;name&quot;=&gt;&quot;lettuce&quot;}}}, &quot;commit&quot;=&gt;&quot;Create Recipe&quot;, &quot;controller&quot;=&gt;&quot;recipes&quot;, &quot;action&quot;=&gt;&quot;create&quot;}
</code></pre>


                                <!--
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor
                                    incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
                                    nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                                    Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
                                    fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
                                    culpa qui officia deserunt mollit anim id est laborum. Sed ut perspiciatis unde
                                    omnis iste natus error sit aperiam.
                                    <br> <br>
                                    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor
                                    incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
                                    nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                                    Duis aute irure dolor in reprehenderit in voluptate.</p>
                                <blockquote class="post-blockquote">
                                    <p>Eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim
                                        veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
                                        commodo consequat.</p>
                                    <div class="blockquote-author"><span>- </span>Jone Doe</div>
                                </blockquote>
                                <p>sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad
                                    minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
                                    commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit
                                    esse cillum dolore eu fugiat nulla pariatur.
                                    <br> <br>
                                    Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia
                                    deserunt mollit anim id est laborum. Sed ut perspiciatis unde omnis iste natus
                                    error sit aperiam.</p>
                                    -->
                                    
                            </div> <!-- End .content -->
                            <div class="line"></div>
                            <div class="share">
                                <div class="post-bottom">
                                    <div class="tag">
                                        <span>Tag:</span>
                                        <a href="#">lifestyle</a>
                                        <a href="#">music</a>
                                        <a href="#">rock</a>
                                    </div> <!-- End .continue -->
                                    <div class="share-iocn">
                                        <span class="share">Share:</span>
                                        <span class="icon"><a href="#"><i class="fa fa-facebook"></i></a></span>
                                        <span class="icon"><a href="#"><i class="fa fa-twitter"></i></a></span>
                                        <span class="icon"><a href="#"><i class="fa fa-pinterest"></i></a></span>
                                    </div> <!-- End .share-iocn -->
                                </div> <!-- End .post-bottom -->
                            </div> <!-- End .share -->
                        </div> <!--  End .post -->
                    </div> <!-- End .blog-post -->
                    <div class="author-box">

                        <div class="photo">
                            <a href="#"><img src="/assets/images/heber-sandoval.jpg" alt="HÃ©ber Sandoval"></a>
                        </div> <!-- End .photo -->
                        <div class="bio">
                            <h5><a href="">HÃ©ber Sandoval</a></h5>
                            <h6>Web developer</h6>
                            <p>As a Web Developer, I have the opportunity to contribute to innovations and break-through that can benefit the end user using vaires technologies.</p>
                            <div class="share-iocn">
                                <span class="social"><a href="https://github.com/hebersandoval"><i class="fa fa-github" target="_blank"></i></a></span>
                                <span class="social"><a href="mailto:&#104;&#101;&#051;&#101;&#114;&#115;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;"><i class="fa fa-envelope"></i></a></span>
                                <span class="social"><a href="https://www.linkedin.com/in/hebersandoval/" target="_blank"><i class="fa fa-linkedin"></i></a></span>
                            </div> <!-- End .share-iocn -->
                        </div> <!-- End .bio -->
                    </div> <!-- End .author-box -->

                    <!-- Related post section --->
                    
                    <!-- Blog comment section -->

                    <!-- Reply comment section -->
                    <br><br><br><br>

                </div>
                <!--
                ===============
                End .primary 
                ===============
                -->
            </div> <!-- End .col-md-8 -->
            <div class="col-md-4">
                <div class="sidebar">
                    <div class="widget-box">
                        <div class="widget-title">
                            <span>About Me</span>
                            <div class="line"></div>
                        </div> <!-- End .widget-title -->
                        <div class="widget-item">
                            <img src="/assets/images/laptop-person.jpg" alt="About Me Image">
                            <div class="sidebar-text">
                                <p>As a Web Developer, I utilize my skill set to build custom applications/websites using varies technologies. These include the use of Ruby/Rails, PHP/Laravel, Python/Django and JS/Node among other tecnhologies.</p>
                            </div> <!-- End .sidebar-text -->
                        </div> <!-- End .widget-item -->
                    </div> <!-- End .widget-box -->

                    <div class="widget-box">
                        <div class="widget-title">
                            <span>CONNECT</span>
                            <div class="line"></div>
                        </div> <!-- End .widget-title -->
                        <div class="widget-item">
                            <span class="social"><a href="https://github.com/hebersandoval"><i class="fa fa-github" target="_blank"></i></a></span>
                            <span class="social"><a href="mailto:&#104;&#101;&#051;&#101;&#114;&#115;&#064;&#103;&#109;&#097;&#105;&#108;&#046;&#099;&#111;&#109;"><i class="fa fa-envelope"></i></a></span>
                            <span class="social"><a href="https://www.linkedin.com/in/hebersandoval/" target="_blank"><i class="fa fa-linkedin"></i></a></span>

                            <!-- <span class="social"><a href="#"><i class="fa fa-facebook"></i></a></span>
                            <span class="social"><a href="#"><i class="fa fa-twitter"></i></a></span>
                            <span class="social"><a href="#"><i class="fa fa-google-plus"></i></a></span>
                            <span class="social"><a href="#"><i class="fa fa-pinterest"></i></a></span>
                            <span class="social"><a href="#"><i class="fa fa-instagram"></i></a></span>
                            <span class="social"><a href="#"><i class="fa fa-youtube-play"></i></a></span>
                            <span class="social"><a href="#"><i class="fa fa-rss"></i></a></span> -->
                        </div> <!-- End .widget-item -->
                    </div> <!-- End .widget-box -->

                    <div class="widget-box">
                        <div class="widget-title">
                            <span>Search</span>
                            <div class="line"></div>
                        </div> <!-- End .widget-title -->
                        <div class="widget-item">
                            <div class="sidebar-text">
                                <div class="search-input">
                                    <input type="text" class="form-control" id="search" name="search"
                                        placeholder="Search Here">
                                </div>
                                <div class="search-btn">
                                    <button type="submit" class="btn-black">Search</button>
                                </div>
                            </div> <!-- End .sidebar-text -->
                        </div> <!-- End .widget-item -->
                    </div> <!-- End .widget-box -->

                    <div class="widget-box">
                        <div class="widget-title">
                            <span>Recent Post</span>
                            <div class="line"></div>
                        </div> <!-- End .widget-title -->
                        <div class="widget-item">
                            <ul class="sidebar-post">
                                <li class="item">
                                    <div class="thum-img">
                                        <img src="/assets/images/placeholder-post-thum.jpg" alt="Small Thumbnail Image">
                                    </div> <!-- End .thum-img -->
                                    <div class="post-meta">
                                        <h4><a href="/blog/2016/09-01-rails-project">Ruby on Rails Project</a></h4>
                                        <p>June 14, 2015</p>
                                    </div> <!-- End .post-meta -->
                                </li> <!-- End .item -->

                                <li class="item">
                                    <div class="thum-img">
                                        <img src="/assets/images/placeholder-post-thum.jpg" alt="Small Thumbnail Image">
                                    </div> <!-- End .thum-img -->
                                    <div class="post-meta">
                                        <h4><a href="/blog/2016/05-03-learning-sinatra">Learning Sinatra</a></h4>
                                        <p>June 14, 2015</p>
                                    </div> <!-- End .post-meta -->
                                </li> <!-- End .item -->

                                <li class="item">
                                    <div class="thum-img">
                                        <img src="/assets/images/placeholder-post-thum.jpg" alt="Small Thumbnail Image">
                                    </div> <!-- End .thum-img -->
                                    <div class="post-meta">
                                        <h4><a href="/blog/2016/10-20-working-with-rails-nested-forms">Working With Rails Nested Forms</a></h4>
                                        <p>June 14, 2015</p>
                                    </div> <!-- End .post-meta -->
                                </li> <!-- End .item -->
                            </ul> <!-- End .sidebar-post -->
                        </div> <!-- End .widget-item -->
                    </div> <!-- End .widget-box -->

                    <!-- Instagram section deleted -->

                    <!-- Tag section deleted -->

                    <div class="widget-box">
                        <div class="widget-title">
                            <span>Category</span>
                            <div class="line"></div>
                        </div> <!-- End .widget-title -->
                        <div class="widget-item">
                            <ul class="category-list">
                                <li class="cat-item"><a href="#">Programming <span>(5)</span></a></li>
                                <li class="cat-item"><a href="#">Web Development<span>(15)</span></a></li>
                                <li class="cat-item"><a href="#">Python<span>(8)</span></a></li>
                                <li class="cat-item"><a href="#">Ruby<span>(11)</span></a></li>
                                <li class="cat-item"><a href="#">JavaScript<span>(10)</span></a></li>
                            </ul> <!-- End .category-list -->
                        </div> <!-- End .widget-item -->
                    </div> <!-- End .widget-box -->

                    <div class="widget-box">
                        <div class="widget-title">
                            <span>Advertisement</span>
                            <div class="line"></div>
                        </div> <!-- End .widget-title -->
                        <div class="widget-item">
                            <div class="ad-img">
                                <a href=""><img src="/assets/images/about-me.jpg" alt="About Me Image"></a>
                            </div> <!-- End .ad-img -->
                        </div> <!-- End .widget-item -->
                    </div> <!-- End .widget-box -->

                    <div class="widget-box">
                        <div class="widget-title">
                            <span>Newsletter</span>
                            <div class="line"></div>
                        </div> <!-- End .widget-title -->
                        <div class="widget-item">
                            <div class="sidebar-text">
                                <p>Want to read my latest post or just learn basic web development skills? Enter you email address to get my newsletters. (Feature coming soon!)</p>
                                <div class="newsletter-input">
                                    <input type="text" class="form-control" id="input-email" name="email"
                                        placeholder="Type Your Email">
                                </div>
                                <div class="newsletter-btn">
                                    <button type="submit" class="btn-black">Send</button>
                                </div>
                            </div> <!-- End .sidebar-text -->
                        </div> <!-- End .widget-item -->
                    </div> <!-- End .widget-box -->

                </div>
                <!--
            =================
                End .sidebar
            =================
            -->
            </div> <!-- End .col-md-4 -->
        </div> <!-- End .row -->
    </div> <!-- End .container -->
</section>
<!--
=======================
    End Section Content
=======================
-->

    <!--******  blog sidebar moved to partial ****** -->

    <!-- ****** blog footer moved to partial ****** -->
    <footer id="footer" class="footer">
        <div class="container">
            <div class="footer-nav">
                <ul class="nav navbar-nav">
                    <li><a href="/">Home</a></li>
                    <li><a href="#">Privacy & Policy</a></li>
                    <li><a href="/blog">Blog</a></li>
                    <li><a href="/about">About Me</a></li>
                    <li><a href="/contact">Contact Me</a></li>
                </ul>
            </div> <!-- End .footer-nav -->
            <div class="copyright">
                <span>Copyright 2016 - 2020, All Rights Reserved.</span>
            </div> <!-- End .copyright -->
        </div> <!-- End .container -->
    </footer>
    <!--
    =======================
        End Footer
    =======================
    -->

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="/assets/js/jquery-1.11.3.min.js"></script>

	<!-- Bootstrap Main -->
	<script src="/assets/js/bootstrap.min.js"></script>

	<!-- Masonry Cascading grid layout library -->
	<script src="/assets/js/masonry.pkgd.min.js"></script>

	<!-- SmartMenus jQuery plugin -->
	<script type="text/javascript" src="/assets/js/jquery.smartmenus.min.js"></script>

	<!-- SmartMenus jQuery Bootstrap Addon -->
	<script type="text/javascript" src="/assets/js/jquery.smartmenus.bootstrap.min.js"></script>

	<!-- Instagram photos -->
	<script type="text/javascript" src="/assets/js/instafeed.min.js"></script>

	<!-- Google Map -->
	<!-- <script src="http://maps.google.com/maps/api/js?sensor=true"></script> -->
	<!-- <script type="text/javascript" src="/assets/js/gmaps.js"></script> -->

	<!-- All custom jQuery -->
	<script src="/assets/js/custom.js"></script>
</body>

</html>